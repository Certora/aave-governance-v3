# Github action for verifying the contracts under src/contracts/voting using certora-cli-beta 6
name: certora-review-voting-chain

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      - uses: Certora/certora-run-action@v1
        with:
          # --disable_auto_cache_key_gen
          configurations: |-
            security/certora/confs/voting/verifyLegality.conf --rule createdVoteHasNonZeroHash
            security/certora/confs/voting/verifyLegality.conf --rule votedPowerIsImmutable
            security/certora/confs/voting/verifyLegality.conf --rule onlyValidProposalCanChangeTally
            security/certora/confs/voting/verifyLegality.conf --rule legalVote
            security/certora/confs/voting/verifyLegality.conf --rule method_reachability
            security/certora/confs/voting/verifyMisc.conf
            security/certora/confs/voting/verifyPower_summary.conf --rule onlyThreeTokens
            security/certora/confs/voting/verifyPower_summary.conf --rule method_reachability
            security/certora/confs/voting/verifyProposal_config.conf --rule startedProposalHasConfig
            security/certora/confs/voting/verifyProposal_config.conf --rule createdProposalHasRoots
            security/certora/confs/voting/verifyProposal_config.conf --rule proposalHasNonzeroDuration newProposalUnusedId configIsImmutable
            security/certora/confs/voting/verifyProposal_config.conf --rule getProposalsConfigsDoesntRevert
            security/certora/confs/voting/verifyProposal_config.conf --rule method_reachability
            security/certora/confs/voting/verifyProposal_states.conf --rule startsBeforeEnds
            security/certora/confs/voting/verifyProposal_states.conf --rule startsStrictlyBeforeEnds
            security/certora/confs/voting/verifyProposal_states.conf --rule proposalLegalStates
            security/certora/confs/voting/verifyProposal_states.conf --rule proposalMethodStateTransitionCompliance
            security/certora/confs/voting/verifyProposal_states.conf --rule proposalTimeStateTransitionCompliance
            security/certora/confs/voting/verifyProposal_states.conf --rule proposalIdIsImmutable
            security/certora/confs/voting/verifyProposal_states.conf --rule proposalImmutability
            security/certora/confs/voting/verifyProposal_states.conf --rule startedProposalHasConfig
            security/certora/confs/voting/verifyProposal_states.conf --rule proposalHasNonzeroDuration method_reachability
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule votingPowerGhostIsVotingPower
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule sumOfVotes
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule voteTallyChangedOnlyByVoting
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule voteUpdatesTally
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule onlyVoteCanChangeResult
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule votingTallyCanOnlyIncrease
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule strangerVoteUnchanged
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule otherProposalUnchanged
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule otherVoterUntouched
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule cannot_vote_twice_with_submitVote_and_submitVoteAsRepresentative
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule cannot_vote_twice_with_submitVoteAsRepresentative_and_submitVote
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule cannot_vote_twice_with_submitVoteSingleProofAsRepresentative_and_submitVote
            security/certora/confs/voting/verifyVoting_and_tally.conf --rule method_reachability
          solc-versions: 0.8.19
          solc-remove-version-prefix: "0."
          cli-version: 7.20.3
          job-name: "AAVE Governance V3 Voting Chain"
          certora-key: ${{ secrets.CERTORAKEY }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
